require('dotenv').config();

const Web3 = require("web3");
const Tx = require('ethereumjs-tx').Transaction;
const rpcURL = process.env["RopstenURL"];
const web3 = new Web3(rpcURL);

const tokenOWner = '0xD7Aa152E5eB105d7F6b0dff9f5821d9129ED86c3';
const privateKeyOwner = Buffer.from(process.env.PRIVATE_KEY_1,'hex');

const tokenBytecode = '6080604052662386f26fc100006006553480156200001c57600080fd5b506040518060400160405280601081526020017f505241435449434520544f4b454e203700000000000000000000000000000000815250600390805190602001906200006a92919062000199565b506040518060400160405280600381526020017f505437000000000000000000000000000000000000000000000000000000000081525060049080519060200190620000b892919062000199565b50620000c96200018860201b60201c565b600a620000d79190620002a4565b624c4b40620000e79190620003e1565b600281905550600254600080620001036200019160201b60201c565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555033600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550620004fa565b60006012905090565b600033905090565b828054620001a79062000459565b90600052602060002090601f016020900481019282620001cb576000855562000217565b82601f10620001e657805160ff191683800117855562000217565b8280016001018555821562000217579182015b8281111562000216578251825591602001919060010190620001f9565b5b5090506200022691906200022a565b5090565b5b80821115620002455760008160009055506001016200022b565b5090565b6000808291508390505b60018511156200029b578086048111156200027357620002726200048f565b5b6001851615620002835780820291505b80810290506200029385620004ed565b945062000253565b94509492505050565b6000620002b18262000442565b9150620002be836200044c565b9250620002ed7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8484620002f5565b905092915050565b600082620003075760019050620003da565b81620003175760009050620003da565b81600181146200033057600281146200033b5762000371565b6001915050620003da565b60ff84111562000350576200034f6200048f565b5b8360020a9150848211156200036a57620003696200048f565b5b50620003da565b5060208310610133831016604e8410600b8410161715620003ab5782820a905083811115620003a557620003a46200048f565b5b620003da565b620003ba848484600162000249565b92509050818404811115620003d457620003d36200048f565b5b81810290505b9392505050565b6000620003ee8262000442565b9150620003fb8362000442565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff04831182151516156200043757620004366200048f565b5b828202905092915050565b6000819050919050565b600060ff82169050919050565b600060028204905060018216806200047257607f821691505b60208210811415620004895762000488620004be565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60008160011c9050919050565b611dfc806200050a6000396000f3fe6080604052600436106100f75760003560e01c80637362377b1161008a578063a482171911610059578063a48217191461037c578063a9059cbb1461039b578063d7dcdcec146103d8578063dd62ed3e1461040457610108565b80637362377b146102ab57806391b7f5ed146102d757806395d89b4114610314578063a457c2d71461033f57610108565b8063313ce567116100c6578063313ce567146101dd578063395093511461020857806340c10f191461024557806370a082311461026e57610108565b806306fdde031461010d578063095ea7b31461013857806318160ddd1461017557806323b872dd146101a057610108565b3661010857610104610441565b5050005b600080fd5b34801561011957600080fd5b506101226105b6565b60405161012f9190611609565b60405180910390f35b34801561014457600080fd5b5061015f600480360381019061015a91906113bd565b610648565b60405161016c91906115ee565b60405180910390f35b34801561018157600080fd5b5061018a610666565b604051610197919061176b565b60405180910390f35b3480156101ac57600080fd5b506101c760048036038101906101c2919061136a565b610670565b6040516101d491906115ee565b60405180910390f35b3480156101e957600080fd5b506101f2610771565b6040516101ff91906117b6565b60405180910390f35b34801561021457600080fd5b5061022f600480360381019061022a91906113bd565b61077a565b60405161023c91906115ee565b60405180910390f35b34801561025157600080fd5b5061026c600480360381019061026791906113bd565b610826565b005b34801561027a57600080fd5b50610295600480360381019061029091906112fd565b6108c4565b6040516102a2919061176b565b60405180910390f35b3480156102b757600080fd5b506102c061090c565b6040516102ce929190611786565b60405180910390f35b3480156102e357600080fd5b506102fe60048036038101906102f991906113fd565b610a15565b60405161030b919061176b565b60405180910390f35b34801561032057600080fd5b50610329610ab8565b6040516103369190611609565b60405180910390f35b34801561034b57600080fd5b50610366600480360381019061036191906113bd565b610b4a565b60405161037391906115ee565b60405180910390f35b610384610441565b604051610392929190611786565b60405180910390f35b3480156103a757600080fd5b506103c260048036038101906103bd91906113bd565b610c3e565b6040516103cf91906115ee565b60405180910390f35b3480156103e457600080fd5b506103ed610c5c565b6040516103fb929190611786565b60405180910390f35b34801561041057600080fd5b5061042b6004803603810190610426919061132a565b610ca1565b604051610438919061176b565b60405180910390f35b600060606000341015610489576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610480906116cb565b60405180910390fd5b600034905060006006548261049e9190611843565b9050670de0b6b3a7640000816104b49190611874565b600080600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461052391906118ce565b92505081905550670de0b6b3a76400008161053e9190611874565b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461058b91906117ed565b9250508190555080604051806060016040528060278152602001611d7e602791399350935050509091565b6060600380546105c59061198a565b80601f01602080910402602001604051908101604052809291908181526020018280546105f19061198a565b801561063e5780601f106106135761010080835404028352916020019161063e565b820191906000526020600020905b81548152906001019060200180831161062157829003601f168201915b5050505050905090565b600061065c610655610d28565b8484610d30565b6001905092915050565b6000600254905090565b600061067d848484610efb565b6000600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006106c8610d28565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905082811015610748576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161073f906116ab565b60405180910390fd5b61076585610754610d28565b858461076091906118ce565b610d30565b60019150509392505050565b60006012905090565b600061081c610787610d28565b848460016000610795610d28565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205461081791906117ed565b610d30565b6001905092915050565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146108b6576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108ad9061164b565b60405180910390fd5b6108c0828261117a565b5050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b60006060600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146109a0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109979061164b565b60405180910390fd5b600047905060003390508073ffffffffffffffffffffffffffffffffffffffff166108fc839081150290604051600060405180830381858888f193505050501580156109f0573d6000803e3d6000fd5b5081604051806060016040528060228152602001611da5602291399350935050509091565b6000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610aa7576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a9e9061164b565b60405180910390fd5b816006819055506006549050919050565b606060048054610ac79061198a565b80601f0160208091040260200160405190810160405280929190818152602001828054610af39061198a565b8015610b405780601f10610b1557610100808354040283529160200191610b40565b820191906000526020600020905b815481529060010190602001808311610b2357829003601f168201915b5050505050905090565b60008060016000610b59610d28565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905082811015610c16576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c0d9061172b565b60405180910390fd5b610c33610c21610d28565b858584610c2e91906118ce565b610d30565b600191505092915050565b6000610c52610c4b610d28565b8484610efb565b6001905092915050565b600060606006546040518060400160405280600381526020017f5765690000000000000000000000000000000000000000000000000000000000815250915091509091565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415610da0576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d979061170b565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610e10576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e079061166b565b60405180910390fd5b80600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92583604051610eee919061176b565b60405180910390a3505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415610f6b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610f62906116eb565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610fdb576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610fd29061162b565b60405180910390fd5b610fe68383836112ce565b60008060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490508181101561106c576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016110639061168b565b60405180910390fd5b818161107891906118ce565b6000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461110891906117ed565b925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8460405161116c919061176b565b60405180910390a350505050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1614156111ea576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016111e19061174b565b60405180910390fd5b6111f6600083836112ce565b806002600082825461120891906117ed565b92505081905550806000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461125d91906117ed565b925050819055508173ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516112c2919061176b565b60405180910390a35050565b505050565b6000813590506112e281611d4f565b92915050565b6000813590506112f781611d66565b92915050565b60006020828403121561131357611312611a49565b5b6000611321848285016112d3565b91505092915050565b6000806040838503121561134157611340611a49565b5b600061134f858286016112d3565b9250506020611360858286016112d3565b9150509250929050565b60008060006060848603121561138357611382611a49565b5b6000611391868287016112d3565b93505060206113a2868287016112d3565b92505060406113b3868287016112e8565b9150509250925092565b600080604083850312156113d4576113d3611a49565b5b60006113e2858286016112d3565b92505060206113f3858286016112e8565b9150509250929050565b60006020828403121561141357611412611a49565b5b6000611421848285016112e8565b91505092915050565b61143381611914565b82525050565b6000611444826117d1565b61144e81856117dc565b935061145e818560208601611957565b61146781611a4e565b840191505092915050565b600061147f6023836117dc565b915061148a82611a5f565b604082019050919050565b60006114a26022836117dc565b91506114ad82611aae565b604082019050919050565b60006114c56022836117dc565b91506114d082611afd565b604082019050919050565b60006114e86026836117dc565b91506114f382611b4c565b604082019050919050565b600061150b6028836117dc565b915061151682611b9b565b604082019050919050565b600061152e6031836117dc565b915061153982611bea565b604082019050919050565b60006115516025836117dc565b915061155c82611c39565b604082019050919050565b60006115746024836117dc565b915061157f82611c88565b604082019050919050565b60006115976025836117dc565b91506115a282611cd7565b604082019050919050565b60006115ba601f836117dc565b91506115c582611d26565b602082019050919050565b6115d981611940565b82525050565b6115e88161194a565b82525050565b6000602082019050611603600083018461142a565b92915050565b600060208201905081810360008301526116238184611439565b905092915050565b6000602082019050818103600083015261164481611472565b9050919050565b6000602082019050818103600083015261166481611495565b9050919050565b60006020820190508181036000830152611684816114b8565b9050919050565b600060208201905081810360008301526116a4816114db565b9050919050565b600060208201905081810360008301526116c4816114fe565b9050919050565b600060208201905081810360008301526116e481611521565b9050919050565b6000602082019050818103600083015261170481611544565b9050919050565b6000602082019050818103600083015261172481611567565b9050919050565b600060208201905081810360008301526117448161158a565b9050919050565b60006020820190508181036000830152611764816115ad565b9050919050565b600060208201905061178060008301846115d0565b92915050565b600060408201905061179b60008301856115d0565b81810360208301526117ad8184611439565b90509392505050565b60006020820190506117cb60008301846115df565b92915050565b600081519050919050565b600082825260208201905092915050565b60006117f882611940565b915061180383611940565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115611838576118376119bc565b5b828201905092915050565b600061184e82611940565b915061185983611940565b925082611869576118686119eb565b5b828204905092915050565b600061187f82611940565b915061188a83611940565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff04831182151516156118c3576118c26119bc565b5b828202905092915050565b60006118d982611940565b91506118e483611940565b9250828210156118f7576118f66119bc565b5b828203905092915050565b600061190d82611920565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600060ff82169050919050565b60005b8381101561197557808201518184015260208101905061195a565b83811115611984576000848401525b50505050565b600060028204905060018216806119a257607f821691505b602082108114156119b6576119b5611a1a565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600080fd5b6000601f19601f8301169050919050565b7f45524332303a207472616e7366657220746f20746865207a65726f206164647260008201527f6573730000000000000000000000000000000000000000000000000000000000602082015250565b7f4f6e6c79206f776e65722063616e2063616c6c20746869732066756e6374696f60008201527f6e2e000000000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a207472616e7366657220616d6f756e742065786365656473206260008201527f616c616e63650000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a207472616e7366657220616d6f756e742065786365656473206160008201527f6c6c6f77616e6365000000000000000000000000000000000000000000000000602082015250565b7f596f752068617665206e6f742073706563696669656420616e7920616d6f756e60008201527f7420666f7220696e766573746d656e742e000000000000000000000000000000602082015250565b7f45524332303a207472616e736665722066726f6d20746865207a65726f20616460008201527f6472657373000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f7760008201527f207a65726f000000000000000000000000000000000000000000000000000000602082015250565b7f45524332303a206d696e7420746f20746865207a65726f206164647265737300600082015250565b611d5881611902565b8114611d6357600080fd5b50565b611d6f81611940565b8114611d7a57600080fd5b5056fe4d4e4320746f6b656e73207472616e7366657272656420746f20796f7572206163636f756e742e4574686572207472616e73666572656420746f206f776e6572206163636f756e742ea2646970667358221220260fa74a29141abacdf3025e34c1b9732f4579dcc8fcddebfff22a70bc1056ac64736f6c63430008070033';
const hexedBytecode = Buffer.from(tokenBytecode, 'hex');

const deployToken = async () => {
    try {
        const txNonce = await web3.eth.getTransactionCount(tokenOWner);

        // Build a transaction object
        const txObject = {
            nonce: web3.utils.toHex(txNonce),
            gasLimit: web3.utils.toHex(1000000),
            gasPrice: web3.utils.toHex(web3.utils.toWei('10', 'gwei')),
            data: hexedBytecode
        }

        // Sign the transaction
        const tx = new Tx(txObject, { 'chain': 'ropsten' });
        tx.sign(privateKeyOwner);

        // Broadcast the transaction
        const serializedTx = tx.serialize();
        const relay = '0x' + serializedTx.toString('hex');
        const response = await web3.eth.sendSignedTransaction(relay);
        console.log('Transaction Hash: ', response.transactionHash);

    } catch (error) {
        console.log('Error: ', error);
    }
}

deployToken();